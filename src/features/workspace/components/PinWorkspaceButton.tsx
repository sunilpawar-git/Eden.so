/**
 * PinWorkspaceButton - Toggle pin for offline workspace availability
 * Gated behind subscription: free users see upgrade prompt.
 * All text from strings.pinning.* -- no hardcoded strings.
 */
import React from 'react';
import { usePinWorkspaceButton } from '../hooks/usePinWorkspaceButton';
import { UpgradePrompt } from '@/shared/components/UpgradePrompt';
import { toast } from '@/shared/stores/toastStore';
import { strings } from '@/shared/localization/strings';
import styles from './PinWorkspaceButton.module.css';

interface PinWorkspaceButtonProps {
    workspaceId: string;
}

export const PinWorkspaceButton = React.memo(function PinWorkspaceButton({ workspaceId }: PinWorkspaceButtonProps) {
    const { isPinned, showUpgrade, setShowUpgrade, storageLabel, handleToggle } = usePinWorkspaceButton(workspaceId);

    const label = isPinned ? strings.pinning.unpin : strings.pinning.pin;
    const storageInfo = isPinned && storageLabel
        ? ` (${strings.pinning.storageUsage}: ${storageLabel})`
        : '';
    const title = isPinned
        ? `${strings.pinning.unpinTooltip}${storageInfo}`
        : strings.pinning.pinTooltip;

    return (
        <>
            <button
                className={`${styles.pinButton} ${isPinned ? styles.pinned : ''}`}
                onClick={handleToggle}
                title={title}
                aria-label={label}
            >
                <svg
                    width="14"
                    height="14"
                    viewBox="0 0 24 24"
                    fill={isPinned ? 'currentColor' : 'none'}
                    stroke="currentColor"
                    strokeWidth="2"
                >
                    <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" />
                </svg>
            </button>
            {showUpgrade && (
                <UpgradePrompt
                    featureName={strings.pinning.pin}
                    onDismiss={() => setShowUpgrade(false)}
                    onUpgrade={() => {
                        setShowUpgrade(false);
                        toast.info(strings.common.comingSoon);
                    }}
                />
            )}
        </>
    );
});
