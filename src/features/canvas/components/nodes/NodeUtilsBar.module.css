/**
 * NodeUtilsBar Styles — Dual-deck card cascade.
 * Two vertical bars slide out from node edge like cards from a deck.
 * barWrapper is anchored to the card edge and extends outward.
 * Deck 1 visibility: data-bar-proximity / data-bar-focused (set by useProximityBar).
 * Deck 2 visibility: .deckTwoOpen / .deckTwoPinned only (set by useNodeUtilsController).
 */

.barWrapper {
    position: absolute;
    top: var(--node-utils-bar-top-offset);
    left: 100%;
    display: flex;
    flex-direction: row;
    gap: var(--node-utils-deck-gap);
    pointer-events: none;
    z-index: var(--z-dropdown);
}

:global([data-bar-placement="left"]) .barWrapper {
    left: auto;
    right: 100%;
    flex-direction: row-reverse;
}

/* Shared deck base — hidden, tucked behind the card edge */
.deckBase {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
    padding: var(--space-xs);
    background: var(--color-surface-elevated);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-full);
    box-shadow: var(--card-shadow);
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transform: translateX(calc(-100% + var(--node-utils-bar-peek))) rotate(var(--node-utils-deck-rotation));
    transition:
        opacity var(--node-utils-transition-duration) cubic-bezier(0.4, 0, 0.2, 1) var(--node-utils-hover-delay-out),
        transform var(--node-utils-transition-duration) cubic-bezier(0.4, 0, 0.2, 1) var(--node-utils-hover-delay-out),
        visibility 0s linear calc(var(--node-utils-transition-duration) + var(--node-utils-hover-delay-out));
}

:global([data-bar-placement="left"]) .deckBase {
    transform: translateX(calc(100% - var(--node-utils-bar-peek))) rotate(calc(-1 * var(--node-utils-deck-rotation)));
}

/* Deck One — cascades out when proximity is near */
.deckOne {
    composes: deckBase;
    z-index: var(--z-dropdown);
}

:global([data-bar-proximity="near"]) .deckOne,
:global([data-bar-focused="true"]) .deckOne {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
    transform: translateX(0) rotate(0deg);
    box-shadow: var(--card-shadow-hover);
    transition:
        opacity var(--node-utils-transition-duration) cubic-bezier(0.4, 0, 0.2, 1) var(--node-utils-hover-delay-in),
        transform var(--node-utils-spring-duration) cubic-bezier(0.34, 1.56, 0.64, 1) var(--node-utils-hover-delay-in),
        visibility 0s linear 0s;
}

:global([data-bar-placement="left"][data-bar-proximity="near"]) .deckOne,
:global([data-bar-placement="left"][data-bar-focused="true"]) .deckOne {
    transform: translateX(0) rotate(0deg);
}

/* Deck Two — cascades out when toggled via chevron button */
.deckTwo {
    composes: deckBase;
    z-index: var(--node-utils-deck-two-z);
    transform: translateX(calc(-100% + var(--node-utils-bar-peek))) rotate(calc(-1 * var(--node-utils-deck-rotation))) scale(0.97);
}

:global([data-bar-placement="left"]) .deckTwo {
    transform: translateX(calc(100% - var(--node-utils-bar-peek))) rotate(var(--node-utils-deck-rotation)) scale(0.97);
}

.deckTwoOpen {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
    transform: translateX(0) rotate(0deg) scale(1);
    box-shadow: var(--card-shadow-hover);
    transition:
        opacity var(--node-utils-transition-duration) cubic-bezier(0.4, 0, 0.2, 1) calc(var(--node-utils-hover-delay-in) + var(--node-utils-deck-stagger-delay)),
        transform var(--node-utils-spring-duration) cubic-bezier(0.34, 1.56, 0.64, 1) calc(var(--node-utils-hover-delay-in) + var(--node-utils-deck-stagger-delay)),
        visibility 0s linear 0s;
}

:global([data-bar-placement="left"]) .deckTwoOpen {
    transform: translateX(0) rotate(0deg) scale(1);
}

/* Pinned-open state: both decks visible, no transition */
.deckOnePinned {
    composes: deckOne;
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
    transform: translateX(0) rotate(0deg);
    box-shadow: var(--card-shadow-hover);
    transition: none;
}

.deckTwoPinned {
    composes: deckTwo;
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
    transform: translateX(0) rotate(0deg) scale(1);
    box-shadow: var(--card-shadow-hover);
    transition: none;
}

/* Peek indicator — subtle colored sliver on node's right edge */
.peekIndicator {
    position: absolute;
    top: 0;
    left: 0;
    width: var(--node-utils-bar-peek);
    height: var(--node-utils-peek-height);
    background: var(--color-primary);
    border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
    opacity: var(--opacity-peek);
    transition: opacity var(--transition-normal);
    z-index: 1;
    pointer-events: none;
    animation: peekPulse 2.5s ease-in-out infinite;
}

:global([data-bar-placement="left"]) .peekIndicator {
    left: auto;
    right: 0;
    border-radius: var(--radius-sm) 0 0 var(--radius-sm);
}

@keyframes peekPulse {
    0%, 100% { opacity: var(--opacity-peek-min); }
    50% { opacity: var(--opacity-peek-max); }
}

@media (prefers-reduced-motion: reduce) {
    .peekIndicator { animation: none; }
    .deckBase { transition: opacity var(--node-utils-transition-duration) ease; }
}
